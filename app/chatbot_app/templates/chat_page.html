{% extends 'base.html' %}

{% load static %}

{% block content %}
<main class="dosai">
    <div class="container">
        <div class="dosai__row">
            <div class="dosai__messages" id="chat-messages"></div>
            <form action='/' class="dosai__chat-bar" id="chat-form">
                <label for="chat-input"></label><textarea type="text" class="dosai__chat-bar-input" rows='1' placeholder='Сообщение DosAI'
                                                          id="chat-input"></textarea>
                <button type='submit' class="dosai__chat-bar-btn">
                    <img src="{% static 'img/dosai/arrow-up.svg' %}" alt="Arrow up"/>
                </button>
            </form>
        </div> <!-- /ROW -->
    </div> <!-- /CONTAINER -->
</main>

<script type="module">
    import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"

    Chatbot.initFull({
        chatflowid: "{{ CHATFLOW_ID }}",
        apiHost: "{{ API_HOST }}",
    })
</script>

<script src='{% static 'js/dosai.bundle.js' %}'></script>

<script>
    document.getElementById('chat-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (message) {
            displayMessage(message, 'user');
            input.value = ''; // Очистить поле ввода после отправки
            // Здесь можно добавить вызов к API для отправки сообщения и получения ответа от сервера
        }
    });

    function displayMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.textContent = text;
        messageDiv.className = sender === 'user' ? 'user-message' : 'bot-message';
        document.getElementById('chat-messages').appendChild(messageDiv);
    }
</script>
{% endblock %}
